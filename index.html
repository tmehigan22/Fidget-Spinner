<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Classic Fidget Spinner</title>

  <style>
    :root {
      --bg: #00A6FB;
      --body: #ECF6FB;
      --ring-dark: #0B0B0B;
      --ring-mid: #1E1E1E;
      --white: #FFFFFF;
      --shadow: 0 20px 48px rgba(0,0,0,.25);
    }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      touch-action: none;
      overscroll-behavior: none;
      user-select: none;
    }

    .wrap {
      height: 100%;
      display: grid;
      place-items: center;
    }

    .spinner {
      width: min(70vmin, 360px);
      aspect-ratio: 1;
      position: relative;

      transform: rotate(0rad);
      transform-origin: 50% 50%;
      will-change: transform;

      filter: drop-shadow(var(--shadow));
    }

    .spinner svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    .logo {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      pointer-events: none;
    }

    .logo-circle {
      width: 26%;
      height: 26%;
      border-radius: 50%;
      background: var(--ring-dark);
      display: grid;
      place-items: center;
      overflow: hidden;
    }

    .logo-circle img {
      width: 70%;
      height: 70%;
      object-fit: contain;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div id="spinner" class="spinner">
      <!-- Spinner geometry with INVISIBLE cutouts via MASK (no visible seams) -->
      <svg viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
        <defs>
          <!-- Mask: white = visible, black = cut out -->
          <mask id="spinnerMask">
            <!-- everything visible by default -->
            <rect width="100%" height="100%" fill="white"></rect>

            <!-- cutouts between lobes (true holes, not painted shapes) -->
            <circle cx="500" cy="187.5" r="143" fill="black" transform="rotate(60 500 500)"></circle>
            <circle cx="500" cy="187.5" r="143" fill="black" transform="rotate(180 500 500)"></circle>
            <circle cx="500" cy="187.5" r="143" fill="black" transform="rotate(300 500 500)"></circle>
          </mask>
        </defs>

        <!-- Body -->
        <g fill="var(--body)" mask="url(#spinnerMask)">
          <circle cx="500" cy="500" r="280"></circle>
          <circle cx="500" cy="187.5" r="170"></circle>
          <circle cx="500" cy="187.5" r="170" transform="rotate(120 500 500)"></circle>
          <circle cx="500" cy="187.5" r="170" transform="rotate(240 500 500)"></circle>
        </g>

        <!-- Bearings (unchanged) -->
        <g>
          <!-- Top -->
          <g transform="translate(500 187.5)">
            <circle r="120" fill="var(--ring-dark)"></circle>
            <circle r="85"  fill="var(--body)"></circle>
            <circle r="45"  fill="var(--white)"></circle>
          </g>

          <!-- Bottom-right -->
          <g transform="rotate(120 500 500)">
            <g transform="translate(500 187.5)">
              <circle r="120" fill="var(--ring-dark)"></circle>
              <circle r="85"  fill="var(--body)"></circle>
              <circle r="45"  fill="var(--white)"></circle>
            </g>
          </g>

          <!-- Bottom-left -->
          <g transform="rotate(240 500 500)">
            <g transform="translate(500 187.5)">
              <circle r="120" fill="var(--ring-dark)"></circle>
              <circle r="85"  fill="var(--body)"></circle>
              <circle r="45"  fill="var(--white)"></circle>
            </g>
          </g>

          <!-- Center bearing -->
          <circle cx="500" cy="500" r="150" fill="var(--ring-dark)"></circle>
        </g>
      </svg>

      <!-- Logo overlay (unchanged) -->
      <div class="logo">
        <div class="logo-circle">
          <img src="logo.png" alt="App logo" />
        </div>
      </div>
    </div>
  </div>

  <script>
    (() => {
      const spinner = document.getElementById("spinner");

      let angle = 0;
      let omega = 0;
      let dragging = false;

      const MAX_OMEGA = 32;
      const FRICTION = 1.6;
      const MIN_OMEGA = 0.05;

      let center = { x: 0, y: 0 };
      let lastAngle = 0;
      const samples = [];

      function updateCenter() {
        const r = spinner.getBoundingClientRect();
        center.x = r.left + r.width / 2;
        center.y = r.top + r.height / 2;
      }

      function pointerAngle(x, y) {
        return Math.atan2(y - center.y, x - center.x);
      }

      function normalize(d) {
        while (d > Math.PI) d -= Math.PI * 2;
        while (d < -Math.PI) d += Math.PI * 2;
        return d;
      }

      function setRotation(r) {
        angle = r;
        spinner.style.transform = `rotate(${angle}rad)`;
      }

      function estimateOmega() {
        if (samples.length < 2) return 0;
        const first = samples[0];
        const last = samples[samples.length - 1];
        const dt = (last.t - first.t) / 1000;
        if (dt <= 0) return 0;
        return (last.a - first.a) / dt;
      }

      spinner.addEventListener("pointerdown", e => {
        updateCenter();
        dragging = true;
        omega = 0;
        samples.length = 0;
        lastAngle = pointerAngle(e.clientX, e.clientY);
        samples.push({ t: performance.now(), a: lastAngle });
        spinner.setPointerCapture(e.pointerId);
      });

      spinner.addEventListener("pointermove", e => {
        if (!dragging) return;
        const a = pointerAngle(e.clientX, e.clientY);
        const d = normalize(a - lastAngle);
        setRotation(angle + d);
        lastAngle = a;
        samples.push({ t: performance.now(), a });
        if (samples.length > 8) samples.shift();
      });

      spinner.addEventListener("pointerup", () => {
        dragging = false;
        omega = Math.max(-MAX_OMEGA, Math.min(MAX_OMEGA, estimateOmega()));
        if (Math.abs(omega) < 0.6) omega = 0;
      });

      let lastFrame = performance.now();
      function animate(now) {
        const dt = (now - lastFrame) / 1000;
        lastFrame = now;

        if (!dragging && Math.abs(omega) > 0) {
          omega *= Math.exp(-FRICTION * dt);
          if (Math.abs(omega) < MIN_OMEGA) omega = 0;
          else setRotation(angle + omega * dt);
        }
        requestAnimationFrame(animate);
      }

      updateCenter();
      window.addEventListener("resize", updateCenter);
      requestAnimationFrame(animate);
    })();
  </script>
</body>
</html>
